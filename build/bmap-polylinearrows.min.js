!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r(require("core-js/modules/es6.array.map.js"),require("core-js/modules/es6.function.bind.js"),require("core-js/modules/es6.number.constructor.js"),require("core-js/modules/es6.array.for-each.js"),require("core-js/modules/es6.object.freeze.js")):"function"==typeof define&&define.amd?define(["core-js/modules/es6.array.map.js","core-js/modules/es6.function.bind.js","core-js/modules/es6.number.constructor.js","core-js/modules/es6.array.for-each.js","core-js/modules/es6.object.freeze.js"],r):(e=e||self).PolylineArrows=r()}(this,function(){"use strict";function i(e,r){for(var t=0;t<r.length;t++){var i=r[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function c(e,r){return null!=e?e:r}return c.EMPTY_OBJECT=Object.freeze({}),function(){function s(e,r,t,i){var n=4<arguments.length&&void 0!==arguments[4]?arguments[4]:{},a=this,o=s;if(!(a instanceof o))throw new TypeError("Cannot call a class as a function");this.mapType=e,this.map=r,this.data=t,this.icon=i,this.step=c(n.step,90),this.iconSize=c(n.iconSize,{x:12,y:12}),this.correctAngle=c(n.correctAngle,0),this.linePoints=[],this.arrowOverlays=[],this.refreshHandlerFunc=null,this.parseLineData(),this.initRefreshEvent(),this.dispatchArrows()}var e,r,t;return e=s,(r=[{key:"parseLineData",value:function(){var e=this.data.geometry;if(e)switch(e.type){case"LineString":this.linePoints=e.coordinates;break;case"MultiLineString":this.linePoints=e.coordinates.flat();break;default:console.error("error polyline data!")}}},{key:"initRefreshEvent",value:function(){this.refreshHandlerFunc=this.refreshHandler.bind(this),this.linePoints&&1<this.linePoints.length&&(this.map.addEventListener("moveend",this.refreshHandlerFunc),this.map.addEventListener("zoomend",this.refreshHandlerFunc))}},{key:"refreshHandler",value:function(){this.dispatchArrows()}},{key:"dispatchArrows",value:function(){for(var e=this,r=(e.clearArrows(),e.step),t=0,i=e.pointToPixel(e.linePoints[0][0],e.linePoints[0][1]),n={},h=0;h<e.linePoints.length-1;h++){var a=e.linePoints[h],o=e.linePoints[h+1],a=e.pointToPixel(a[0],a[1]),o=e.pointToPixel(o[0],o[1]),s=o.x-a.x,a=a.y-o.y;if(0!=s||0!=a){var c=Math.atan2(a,s),l=void 0,l=0===c?s:a/Math.sin(c);if(Number(l+t)<Number(r))t+=l,i=o;else if(0==t){for(var u=Math.floor(l/r),p=-Math.sin(c)*r,d=Math.cos(c)*r,f=0;f<u;f++)n.x=i.x+d,n.y=i.y+p,e.addArrow(i=n,c);t=l%r,i=o}else{for(var s=r-t,y=-Math.sin(c)*s,v=Math.cos(c)*s,m=(n.x=i.x+v,n.y=i.y+y,e.addArrow(i=n,c),t=(l-s)%r,Math.floor((l-s)/r)),y=-Math.sin(c)*r,v=Math.cos(c)*r,w=0;w<m;w++)n.x=i.x+v,n.y=i.y+y,e.addArrow(i=n,c);i=o}}}}},{key:"addArrow",value:function(e,r){var t=this.map.getBounds(),e=this.pixelToPoint(e.x,e.y);t.containsPoint(e)&&(t=r/Math.PI*180-this.correctAngle,this.drawArrow(e,-t))}},{key:"drawArrow",value:function(e,r){e=this.createMarker(e);e.setRotation(r),this.map.addOverlay(e),this.arrowOverlays.push(e)}},{key:"clearArrows",value:function(){var r=this;this.arrowOverlays.forEach(function(e){r.map.removeOverlay(e)}),this.arrowOverlays=[]}},{key:"setArrowsVisible",value:function(r){this.arrowOverlays.forEach(function(e){r?e.show():e.hide()})}},{key:"updateData",value:function(e){this.data=e,this.parseLineData(),this.clearArrows(),this.dispatchArrows()}},{key:"pointToPixel",value:function(e,r){var t;switch(this.mapType){case"BMap":t=this.map.pointToPixel(new BMap.Point(e,r));break;case"BMapGL":t=this.map.pointToPixel(new BMapGL.Point(e,r));break;default:console.log("请输入正确的地图构造函数：['BMap','BMapGL']中的一种！")}return t}},{key:"pixelToPoint",value:function(e,r){var t;switch(this.mapType){case"BMap":t=this.map.pixelToPoint(new BMap.Pixel(e,r));break;case"BMapGL":t=this.map.pixelToPoint(new BMapGL.Pixel(e,r));break;default:console.log("请输入正确的地图构造函数：['BMap','BMapGL']中的一种！")}return t}},{key:"createMarker",value:function(e){var r,t;switch(this.mapType){case"BMap":r=new BMap.Icon(this.icon,new BMap.Size(this.iconSize.x,this.iconSize.y)),t=new BMap.Marker(e,{icon:r});break;case"BMapGL":r=new BMapGL.Icon(this.icon,new BMapGL.Size(this.iconSize.x,this.iconSize.y)),t=new BMapGL.Marker(e,{icon:r});break;default:console.log("请输入正确的地图构造函数：['BMap','BMapGL']中的一种！")}return t}},{key:"destory",value:function(){this.clearArrows(),this.map.removeEventListener("moveend",this.moveendHandlerFunc),this.map.removeEventListener("zoomend",this.zoomendHandlerFunc)}}])&&i(e.prototype,r),t&&i(e,t),Object.defineProperty(e,"prototype",{writable:!1}),s}()});
//# sourceMappingURL=bmap-polylinearrows.min.js.map

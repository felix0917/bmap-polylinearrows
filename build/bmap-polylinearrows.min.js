!function(e,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i(require("core-js/modules/es6.array.map.js"),require("core-js/modules/es6.function.bind.js"),require("core-js/modules/es6.number.constructor.js"),require("core-js/modules/es6.array.for-each.js"),require("core-js/modules/es6.object.freeze.js")):"function"==typeof define&&define.amd?define(["core-js/modules/es6.array.map.js","core-js/modules/es6.function.bind.js","core-js/modules/es6.number.constructor.js","core-js/modules/es6.array.for-each.js","core-js/modules/es6.object.freeze.js"],i):(e=e||self).PolylineArrows=i()}(this,function(){"use strict";function t(e,i){for(var n=0;n<i.length;n++){var t=i[n];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}function l(e,i){return null!=e?e:i}return l.EMPTY_OBJECT=Object.freeze({}),function(){function s(e,i,n,t){var r=4<arguments.length&&void 0!==arguments[4]?arguments[4]:{},o=this,a=s;if(!(o instanceof a))throw new TypeError("Cannot call a class as a function");this.mapType=e,this.map=i,this.data=n,this.icon=t,this.step=l(r.step,90),this.iconSize=l(r.iconSize,{x:12,y:12}),this.correctAngle=l(r.correctAngle,0),this.lines=[],this.arrowOverlays=[],this.arrowGeojsonArr=[],this.moveendHandlerFunc=null,this.zoomendHandlerFunc=null,this.parseLineData(),this.initRefreshEvent()}var e,i,n;return e=s,(i=[{key:"parseLineData",value:function(){var e=this.data.geometry;if(e)switch(e.type){case"LineString":this.lines=e.coordinates;break;case"MultiLineString":this.lines=e.coordinates.flat();break;default:console.error("error polyline data!")}}},{key:"initRefreshEvent",value:function(){this.moveendHandlerFunc=this.moveendHandler.bind(this),this.zoomendHandlerFunc=this.zoomendHandler.bind(this),this.lines&&1<this.lines.length&&(this.map.addEventListener("moveend",this.moveendHandlerFunc),this.map.addEventListener("zoomend",this.zoomendHandlerFunc))}},{key:"moveendHandler",value:function(){this.dispatchArrows()}},{key:"zoomendHandler",value:function(){this.dispatchArrows()}},{key:"dispatchArrows",value:function(){var d=this,p=(d.clearArrows(),d.step),f=0,m=0,v=d.pointToPixel(d.lines[0][0],d.lines[0][1]),y={};d.lines.map(function(e,i){if(i!==d.lines.length-1){var e=d.pointToPixel(e[0],e[1]),i=d.pointToPixel(d.lines[i+1][0],d.lines[i+1][1]),n=i.x-e.x,e=e.y-i.y;if(0!=n||0!=e){var t=Math.atan2(e,n),n=0===t?n:e/Math.sin(t);if(Number(n)<Number(p-m))m+=n,v=i;else if(0==m){f=n%p;for(var r=Math.floor(n/p),o=-Math.sin(t)*p,h=Math.cos(t)*p,a=0;a<r;a++)y.x=v.x+h,y.y=v.y+o,v=y,d.addArrow(y,t);m=f,v=i}else{for(var e=p-m,s=-Math.sin(t)*e,l=Math.cos(t)*e,u=(y.x=v.x+l,y.y=v.y+s,v=y,d.addArrow(y,t),f=(n-e)%p,Math.floor((n-e)/p)),s=-Math.sin(t)*p,l=Math.cos(t)*p,c=0;c<u;c++)y.x=v.x+l,y.y=v.y+s,v=y,d.addArrow(y,t);m=f,v=i}}}})}},{key:"addArrow",value:function(e,i){var n=this.map.getBounds(),e=this.pixelToPoint(e.x,e.y);n.containsPoint(e)&&(n=i/Math.PI*180-this.correctAngle,this.drawArrow(e,-n))}},{key:"drawArrow",value:function(e,i){e=this.createMarker(e);e.setRotation(i),this.map.addOverlay(e),this.arrowOverlays.push(e)}},{key:"clearArrows",value:function(){var i=this;this.arrowOverlays.forEach(function(e){i.map.removeOverlay(e)}),this.arrowOverlays=[]}},{key:"setArrowsVisible",value:function(i){this.arrowOverlays.forEach(function(e){i?e.show():e.hide()})}},{key:"updateData",value:function(e){this.data=e,this.parseLineData(),this.clearArrows(),this.dispatchArrows()}},{key:"pointToPixel",value:function(e,i){var n;switch(this.mapType){case"BMap":n=this.map.pointToPixel(new BMap.Point(e,i));break;case"BMapGL":n=this.map.pointToPixel(new BMapGL.Point(e,i));break;default:console.log("请输入正确的地图构造函数：['BMap','BMapGL']中的一种！")}return n}},{key:"pixelToPoint",value:function(e,i){var n;switch(this.mapType){case"BMap":n=this.map.pixelToPoint(new BMap.Pixel(e,i));break;case"BMapGL":n=this.map.pixelToPoint(new BMapGL.Pixel(e,i));break;default:console.log("请输入正确的地图构造函数：['BMap','BMapGL']中的一种！")}return n}},{key:"createMarker",value:function(e){var i,n;switch(this.mapType){case"BMap":i=new BMap.Icon(this.icon,new BMap.Size(this.iconSize.x,this.iconSize.y)),n=new BMap.Marker(e,{icon:i});break;case"BMapGL":i=new BMapGL.Icon(this.icon,new BMapGL.Size(this.iconSize.x,this.iconSize.y)),n=new BMapGL.Marker(e,{icon:i});break;default:console.log("请输入正确的地图构造函数：['BMap','BMapGL']中的一种！")}return n}},{key:"destory",value:function(){this.clearArrows(),this.map.removeEventListener("moveend",this.moveendHandlerFunc),this.map.removeEventListener("zoomend",this.zoomendHandlerFunc)}}])&&t(e.prototype,i),n&&t(e,n),Object.defineProperty(e,"prototype",{writable:!1}),s}()});
//# sourceMappingURL=bmap-polylinearrows.min.js.map

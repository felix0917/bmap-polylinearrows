{"version":3,"file":"bmap-polylinearrows.js","sources":["../src/utils/defaultValue.js","../src/core/PolylineArrows.js"],"sourcesContent":["/**\n * Returns the first parameter if not undefined, otherwise the second parameter.\n * Useful for setting a default value for a parameter.\n *\n * @function\n *\n * @param {*} a\n * @param {*} b\n * @returns {*} Returns the first parameter if not undefined, otherwise the second parameter.\n *\n * @example\n * param = Cesium.defaultValue(param, 'default');\n */\n function defaultValue(a, b) {\n    if (a !== undefined && a !== null) {\n      return a;\n    }\n    return b;\n  }\n  \n  /**\n   * A frozen empty object that can be used as the default value for options passed as\n   * an object literal.\n   * @type {Object}\n   * @memberof defaultValue\n   */\n  defaultValue.EMPTY_OBJECT = Object.freeze({});\n  \n  export default defaultValue;","import defaultValue from '../utils/defaultValue';\n\nclass PolylineArrows {\n    constructor(mapType, map, data, icon, opts = {}) {\n        this.mapType = mapType; // 地图类型，支持['BMap','BMapGL']\n        this.map = map // 地图实例化对象\n        this.data = data; // geojson格式的polyline数据\n        this.icon = icon; // 箭头图标\n        this.step = defaultValue(opts.step, 90); // 箭头间距\n        this.iconSize = defaultValue(opts.iconSize, { x: 12, y: 12 }); // 箭头大小，单位px\n        this.correctAngle = defaultValue(opts.correctAngle, 0); // 图标角度校正：图标的起始角度应该对准水平轴朝右（---->），单位：角度制\n\n        // 私有变量\n        this.linePoints = []; // 扁平化线路坐标数组\n        this.arrowOverlays = []; // 箭头覆盖物容器\n        this.refreshHandlerFunc = null; // 箭头更新处理函数\n\n        this.parseLineData();\n        this.initRefreshEvent();\n        this.dispatchArrows(); // 初始化加载\n    }\n\n    /**\n     * 解析线路数据\n     */\n    parseLineData() {\n        let geo = this.data.geometry;\n        if (!geo) return;\n\n        let { type } = geo;\n        switch (type) {\n            case 'LineString':\n                this.linePoints = geo.coordinates;\n                break;\n            case 'MultiLineString':\n                this.linePoints = geo.coordinates.flat();\n                break;\n            default:\n                console.error('error polyline data!');\n                break;\n        }\n    }\n\n    /**\n     * 初始化箭头更新事件\n     * 地图平移和缩放结束时触发\n     */\n    initRefreshEvent() {\n        this.refreshHandlerFunc = this.refreshHandler.bind(this);\n\n        if (this.linePoints && this.linePoints.length > 1) {\n            this.map.addEventListener('moveend', this.refreshHandlerFunc);\n            this.map.addEventListener('zoomend', this.refreshHandlerFunc);\n        }\n    }\n\n    /**\n     * 地图平移缩放结束事件处理\n     */\n    refreshHandler() {\n        this.dispatchArrows();\n    }\n\n    /**\n    * 箭头绘制调度中心\n    */\n    dispatchArrows() {\n        let that = this;\n        // 每次更新前先清空所有箭头数据\n        that.clearArrows();\n\n        let step = that.step;\n        let sylength = 0;\n        let currrentLength = 0;\n        let currentStart = that.pointToPixel(that.linePoints[0][0], that.linePoints[0][1]);\n        let arrowNode = {};\n        for (let i = 0; i < that.linePoints.length - 1; i++) {\n            let currentLinePoint = that.linePoints[i];\n            let nextLinePoint = that.linePoints[i + 1];\n\n            let start = that.pointToPixel(currentLinePoint[0], currentLinePoint[1]);\n            let end = that.pointToPixel(nextLinePoint[0], nextLinePoint[1]);\n            let [dx, dy] = [end.x - start.x, start.y - end.y];\n            if (dx === 0 && dy === 0) { // 意味着折线中节点太近，忽略这段距离\n                continue;\n            }\n\n            let rotation = Math.atan2(dy, dx); // 两点旋转角度差\n            let nodeDistance; //  两点像素距离\n            if (rotation === 0) {\n                nodeDistance = dx;\n            } else {\n                nodeDistance = dy / Math.sin(rotation);\n            }\n\n            if (Number(nodeDistance) < Number(step - currrentLength)) { // 间距过短\n                currrentLength += nodeDistance;\n                currentStart = end;\n            } else {\n                if (currrentLength == 0) {\n                    sylength = nodeDistance % step;\n                    let splitNum = Math.floor(nodeDistance / step);\n                    let Y = -Math.sin(rotation) * step;\n                    let X = Math.cos(rotation) * step;\n                    for (let i = 0; i < splitNum; i++) {\n                        arrowNode.x = currentStart.x + X;\n                        arrowNode.y = currentStart.y + Y;\n                        currentStart = arrowNode;\n\n                        that.addArrow(arrowNode, rotation);\n                    }\n                    currrentLength = sylength;\n                    currentStart = end;\n                } else {\n                    let littleStep = step - currrentLength;\n                    let Y = -Math.sin(rotation) * littleStep;\n                    let X = Math.cos(rotation) * littleStep;\n                    arrowNode.x = currentStart.x + X;\n                    arrowNode.y = currentStart.y + Y;\n                    currentStart = arrowNode;\n\n                    that.addArrow(arrowNode, rotation);\n\n                    sylength = (nodeDistance - littleStep) % step;\n                    let splitNum = Math.floor((nodeDistance - littleStep) / step);\n                    Y = -Math.sin(rotation) * step;\n                    X = Math.cos(rotation) * step;\n                    for (let i = 0; i < splitNum; i++) {\n                        arrowNode.x = currentStart.x + X;\n                        arrowNode.y = currentStart.y + Y;\n                        currentStart = arrowNode;\n\n                        that.addArrow(arrowNode, rotation);\n                    }\n                    currrentLength = sylength;\n                    currentStart = end;\n                }\n            }\n        }\n    }\n\n    /**\n     * 新增箭头\n     * @param arrowNode 箭头对象\n     * @param rotation 旋转角度\n     */\n    addArrow(arrowNode, rotation) {\n        let seeExtent = this.map.getBounds();\n        let arrowPoint = this.pixelToPoint(arrowNode.x, arrowNode.y);\n\n        // 仅在屏幕可视区域内加载\n        if (seeExtent.containsPoint(arrowPoint)) {\n            let currrentAngle = (rotation / Math.PI) * 180 - this.correctAngle;\n            this.drawArrow(arrowPoint, -currrentAngle);\n        }\n    }\n\n\n    /**\n     * 使用百度地图API绘制箭头\n     * @param arrowPoint 箭头像素坐标\n     * @param rotation 旋转角度\n     */\n    drawArrow(arrowPoint, rotation) {\n        let marker = this.createMarker(arrowPoint);\n        marker.setRotation(rotation);\n\n        this.map.addOverlay(marker);\n        this.arrowOverlays.push(marker);\n    }\n\n\n    /**\n     * 清除箭头\n     */\n    clearArrows() {\n        this.arrowOverlays.forEach((overlay) => {\n            this.map.removeOverlay(overlay);\n        });\n\n        this.arrowOverlays = [];\n    }\n\n    /**\n     * 设置箭头可见性\n     * @param visible 可见性\n     */\n    setArrowsVisible(visible) {\n        this.arrowOverlays.forEach((overlay) => {\n            if (visible) {\n                overlay.show();\n            } else {\n                overlay.hide();\n            }\n        });\n    }\n\n    /**\n     * 更新箭头数据\n     * @param newData 新箭头数据\n     */\n    updateData(newData) {\n        this.data = newData;\n        this.parseLineData();\n        this.clearArrows();\n        this.dispatchArrows();\n    }\n\n    /**\n     * 经纬度坐标转屏幕坐标\n     * @param lng 经度\n     * @param lat 纬度\n     */\n    pointToPixel(lng, lat) {\n        let pixel;\n        switch (this.mapType) {\n            case 'BMap':\n                pixel = this.map.pointToPixel(new BMap.Point(lng, lat));\n                break;\n            case 'BMapGL':\n                pixel = this.map.pointToPixel(new BMapGL.Point(lng, lat));\n                break;\n            default:\n                console.log(`请输入正确的地图构造函数：['BMap','BMapGL']中的一种！`);\n                break;\n        }\n\n        return pixel;\n    }\n\n    /**\n    * 屏幕坐标转经纬度坐标\n    * @param x 屏幕坐标x\n    * @param y 屏幕坐标y\n    */\n    pixelToPoint(x, y) {\n        let point;\n        switch (this.mapType) {\n            case 'BMap':\n                point = this.map.pixelToPoint(new BMap.Pixel(x, y));\n                break;\n            case 'BMapGL':\n                point = this.map.pixelToPoint(new BMapGL.Pixel(x, y));\n                break;\n            default:\n                console.log(`请输入正确的地图构造函数：['BMap','BMapGL']中的一种！`);\n                break;\n        }\n\n        return point;\n    }\n\n    /**\n     * 创建marker\n     * @param icon 图标\n     * @param point 坐标点\n     */\n    createMarker(point) {\n        let myIcon;\n        let marker;\n        switch (this.mapType) {\n            case 'BMap':\n                myIcon = new BMap.Icon(this.icon, new BMap.Size(this.iconSize.x, this.iconSize.y));\n                marker = new BMap.Marker(point, {\n                    icon: myIcon,\n                });\n                break;\n            case 'BMapGL':\n                myIcon = new BMapGL.Icon(this.icon, new BMapGL.Size(this.iconSize.x, this.iconSize.y));\n                marker = new BMapGL.Marker(point, {\n                    icon: myIcon,\n                });\n                break;\n            default:\n                console.log(`请输入正确的地图构造函数：['BMap','BMapGL']中的一种！`);\n                break;\n        }\n\n        return marker;\n    }\n\n    /**\n    * 析构函数\n    */\n    destory() {\n        this.clearArrows();\n\n        this.map.removeEventListener('moveend', this.moveendHandlerFunc);\n        this.map.removeEventListener('zoomend', this.zoomendHandlerFunc);\n    }\n}\n\nexport default PolylineArrows;"],"names":["defaultValue","a","b","undefined","EMPTY_OBJECT","Object","freeze","PolylineArrows","mapType","map","data","icon","opts","step","iconSize","x","y","correctAngle","linePoints","arrowOverlays","refreshHandlerFunc","parseLineData","initRefreshEvent","dispatchArrows","geo","geometry","type","coordinates","flat","console","error","refreshHandler","bind","length","addEventListener","that","clearArrows","sylength","currrentLength","currentStart","pointToPixel","arrowNode","i","currentLinePoint","nextLinePoint","start","end","dx","dy","rotation","Math","atan2","nodeDistance","sin","Number","splitNum","floor","Y","X","cos","addArrow","littleStep","seeExtent","getBounds","arrowPoint","pixelToPoint","containsPoint","currrentAngle","PI","drawArrow","marker","createMarker","setRotation","addOverlay","push","forEach","overlay","removeOverlay","visible","show","hide","newData","lng","lat","pixel","BMap","Point","BMapGL","log","point","Pixel","myIcon","Icon","Size","Marker","removeEventListener","moveendHandlerFunc","zoomendHandlerFunc"],"mappings":"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"}
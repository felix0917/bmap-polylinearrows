<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>bmapgl polylinearrows example</title>
    <style>
        body,
        html,
        #container {
            overflow: hidden;
            width: 100%;
            height: 100%;
            margin: 0;
            font-family: "微软雅黑";
        }

        .info {
            z-index: 999;
            width: auto;
            min-width: 22rem;
            padding: .75rem 1.25rem;
            margin-left: 1.25rem;
            position: fixed;
            top: 1rem;
            background-color: #fff;
            border-radius: .25rem;
            font-size: 14px;
            color: #666;
            box-shadow: 0 2px 6px 0 rgba(27, 142, 236, 0.5);
        }
    </style>
    <script src="//api.map.baidu.com/api?type=webgl&v=1.0&ak=你的密钥"></script>
    <script src="./bmap-polylinearrows.min.js"></script>
</head>

<body>
    <div id="container"></div>
</body>
<script>
    let map = new BMapGL.Map('container'); // 创建Map实例
    map.centerAndZoom(new BMapGL.Point(121.5149319, 31.268328), 17); // 初始化地图,设置中心点坐标和地图级别
    map.enableScrollWheelZoom(true); // 开启鼠标滚轮缩放

    let data = {
        geometry: {
            "type": "MultiLineString",
            "coordinates": [
                [
                    [
                        121.50259791977119,
                        31.234271035048522
                    ],
                    [
                        121.5028609436245,
                        31.234037681240462
                    ],
                    [
                        121.50282492157355,
                        31.23394474095766
                    ],
                    [
                        121.50258192993311,
                        31.233763723281374
                    ],
                    [
                        121.50246991123602,
                        31.233736705687715
                    ],
                    [
                        121.50202489068637,
                        31.234446725457403
                    ],
                    [
                        121.50189993638993,
                        31.234569693108806
                    ],
                    [
                        121.50175989056093,
                        31.234666723966356
                    ],
                    [
                        121.50157187521768,
                        31.234716744607788
                    ],
                    [
                        121.50128989711811,
                        31.234934735485933
                    ],
                    [
                        121.50115991231081,
                        31.23513474012597
                    ],
                    [
                        121.50179995498667,
                        31.235511745008008
                    ],
                    [
                        121.50197988558031,
                        31.235660724814885
                    ],
                    [
                        121.4984939212183,
                        31.23905269152327
                    ],
                    [
                        121.4982739261989,
                        31.239473678014225
                    ],
                    [
                        121.49781291581118,
                        31.24011773582157
                    ],
                    [
                        121.49719092907607,
                        31.241213719970606
                    ],
                    [
                        121.49713092226801,
                        31.24137372841386
                    ],
                    [
                        121.49694093065264,
                        31.24222571280417
                    ],
                    [
                        121.49692089843977,
                        31.24257575125138
                    ],
                    [
                        121.49662894914903,
                        31.244647705033497
                    ],
                    [
                        121.49674887293462,
                        31.245416687375002
                    ],
                    [
                        121.49689790181873,
                        31.246375687406516
                    ],
                    [
                        121.49694793743562,
                        31.24701468084072
                    ],
                    [
                        121.49687786960585,
                        31.247455698765226
                    ],
                    [
                        121.4967069220673,
                        31.24785673461007
                    ],
                    [
                        121.4966759305272,
                        31.24848668775087
                    ],
                    [
                        121.49671590512241,
                        31.248696696914894
                    ],
                    [
                        121.49702689848995,
                        31.24971370264669
                    ],
                    [
                        121.49707594597079,
                        31.250122678307022
                    ],
                    [
                        121.49734687491261,
                        31.250830721389608
                    ],
                    [
                        121.4972059307781,
                        31.251561681104832
                    ],
                    [
                        121.49617287944162,
                        31.251511746650895
                    ],
                    [
                        121.49632289646179,
                        31.25249970296929
                    ],
                    [
                        121.49644192194187,
                        31.253608739221786
                    ],
                    [
                        121.49642188972899,
                        31.25374873771323
                    ],
                    [
                        121.4965818779403,
                        31.254006738794047
                    ],
                    [
                        121.49651189994108,
                        31.254247683222616
                    ],
                    [
                        121.49631094899851,
                        31.255029706456323
                    ],
                    [
                        121.49620988962863,
                        31.25527967776508
                    ],
                    [
                        121.49603993022615,
                        31.25552169936474
                    ],
                    [
                        121.49575795212657,
                        31.256414688818627
                    ],
                    [
                        121.49562688935266,
                        31.256825718864068
                    ],
                    [
                        121.49569686735188,
                        31.25702475060041
                    ],
                    [
                        121.49557694356629,
                        31.257345716358014
                    ],
                    [
                        121.49562688935266,
                        31.257685742837353
                    ],
                    [
                        121.49565689275668,
                        31.257794711569904
                    ],
                    [
                        121.49602690479624,
                        31.258011722576693
                    ],
                    [
                        121.49761986995709,
                        31.258706740923635
                    ],
                    [
                        121.49842187711639,
                        31.25895971211919
                    ],
                    [
                        121.49882288069605,
                        31.25903673005923
                    ],
                    [
                        121.50014491691509,
                        31.25908774090442
                    ],
                    [
                        121.50118587334005,
                        31.259181736609783
                    ],
                    [
                        121.50181693296082,
                        31.259307681446106
                    ],
                    [
                        121.50242787053814,
                        31.259625706836886
                    ],
                    [
                        121.50276787917367,
                        31.259833684516153
                    ],
                    [
                        121.50357788125201,
                        31.260620754296763
                    ],
                    [
                        121.5042378663102,
                        31.261118737077002
                    ],
                    [
                        121.50480793098683,
                        31.26141769524606
                    ],
                    [
                        121.50647689279383,
                        31.262165703841905
                    ],
                    [
                        121.5069168828326,
                        31.26246573903356
                    ],
                    [
                        121.50760588315876,
                        31.26300669511107
                    ],
                    [
                        121.50832488688894,
                        31.26376672925076
                    ],
                    [
                        121.51197892421189,
                        31.266499683458143
                    ],
                    [
                        121.51317591630394,
                        31.26740568612683
                    ],
                    [
                        121.51406389130055,
                        31.26793172077981
                    ],
                    [
                        121.51493192391483,
                        31.26832873338361
                    ],
                    [
                        121.51562990729609,
                        31.26853468541864
                    ],
                    [
                        121.51611894481572,
                        31.26862874878605
                    ],
                    [
                        121.51739588609816,
                        31.26903069692397
                    ],
                    [
                        121.51842193065164,
                        31.269421686091146
                    ],
                    [
                        121.51887090374554,
                        31.269636741010125
                    ],
                    [
                        121.5196779414157,
                        31.270086680288752
                    ],
                    [
                        121.52044491466012,
                        31.270685695725305
                    ],
                    [
                        121.52335192112096,
                        31.273534728158737
                    ],
                    [
                        121.52392890275001,
                        31.27413372148506
                    ],
                    [
                        121.52443689451592,
                        31.27464174012355
                    ],
                    [
                        121.52577087819823,
                        31.275682691311655
                    ],
                    [
                        121.52837794044929,
                        31.277165743156733
                    ],
                    [
                        121.52946291384424,
                        31.277774743578718
                    ],
                    [
                        121.52993991407004,
                        31.277723742935567
                    ],
                    [
                        121.53086588738972,
                        31.277960691224806
                    ],
                    [
                        121.53173086576528,
                        31.278316691203948
                    ],
                    [
                        121.53202991166955,
                        31.27853172564447
                    ],
                    [
                        121.53318387492767,
                        31.279413693442343
                    ],
                    [
                        121.5347348892212,
                        31.280432756700833
                    ],
                    [
                        121.5350139029126,
                        31.280777714192748
                    ],
                    [
                        121.53532193187196,
                        31.280983715934273
                    ],
                    [
                        121.53679488341668,
                        31.28136169322867
                    ],
                    [
                        121.53769992621798,
                        31.281609742407706
                    ],
                    [
                        121.53875390807283,
                        31.28194975773894
                    ],
                    [
                        121.54159991958956,
                        31.282562738910116
                    ],
                    [
                        121.5431529101552,
                        31.28296069231043
                    ],
                    [
                        121.54421794116783,
                        31.283159745526902
                    ],
                    [
                        121.54503387206255,
                        31.283293681870948
                    ],
                    [
                        121.54623894890418,
                        31.283574746972906
                    ],
                    [
                        121.54750295458726,
                        31.284015746673937
                    ],
                    [
                        121.54882687724788,
                        31.28476573455922
                    ],
                    [
                        121.55000195068548,
                        31.28561369735195
                    ],
                    [
                        121.5505799204506,
                        31.285991733054246
                    ],
                    [
                        121.55183494307859,
                        31.286818700103822
                    ],
                    [
                        121.5523229026316,
                        31.287094739904596
                    ],
                    [
                        121.55284194355526,
                        31.287311682853275
                    ],
                    [
                        121.55401791529837,
                        31.28804575171626
                    ],
                    [
                        121.55462588846753,
                        31.288412745409243
                    ],
                    [
                        121.55546292954175,
                        31.28899173925215
                    ],
                    [
                        121.55738790841906,
                        31.290229717103838
                    ],
                    [
                        121.56026194706769,
                        31.29200075215602
                    ],
                    [
                        121.56197986652496,
                        31.293069744592884
                    ],
                    [
                        121.56227891242925,
                        31.292790713829934
                    ],
                    [
                        121.56248893625747,
                        31.292531739826387
                    ],
                    [
                        121.56254894306554,
                        31.292411702779138
                    ],
                    [
                        121.5625189396615,
                        31.292251704572532
                    ],
                    [
                        121.5627288736592,
                        31.291812749550107
                    ],
                    [
                        121.56353869607645,
                        31.28900639727752
                    ]
                ]
            ]
        }
    }

    let pts = [];
    data.geometry.coordinates[0].forEach(coor => {
        pts.push(new BMapGL.Point(coor[0], coor[1]));
    })
    // 绘制线
    let polyline = new BMapGL.Polyline(pts, {
        strokeColor: 'blue',
        strokeWeight: 10,
        strokeOpacity: 0.6
    });
    map.addOverlay(polyline);

    let icon = createSingleArrowIcon()
    let polylineArrows = new PolylineArrows('BMapGL', map, data, icon, { correctAngle: 90 });

    /**
     * 线路单方向箭头图标
     *  ->
     * @param width 箭头图标宽度
     * @param color 箭头颜色
     * @param lineWidth 箭头厚度
     * @param angle 箭头夹角程度，数值越小夹角越大
     */
    function createSingleArrowIcon(color = '#fff', width = 15, lineWidth = 4, angle = 2) {
        let canvas = document.createElement('canvas');
        canvas.width = width;
        canvas.height = width;
        let ctx = canvas.getContext('2d');
        ctx.strokeStyle = color;
        ctx.lineJoin = 'round';
        ctx.lineWidth = lineWidth;
        ctx.moveTo(-angle, width - angle);
        ctx.lineTo(width / 2, 6);
        ctx.lineTo(width + angle, width - angle);
        ctx.stroke();

        return canvas.toDataURL();
    }
</script>

</html>